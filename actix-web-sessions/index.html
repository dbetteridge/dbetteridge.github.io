<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.a03ac9cc63f55f1507aa.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.32.6"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=cbc15578f9d2c0cdc250835e0a7771d3" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=cbc15578f9d2c0cdc250835e0a7771d3"/><title data-react-helmet="true">Actix-Web with sessions | Occasional Blog</title><meta data-react-helmet="true" name="description" content="A simple sessions implementation with actix-web"/><meta data-react-helmet="true" name="image" content="https://danielbetteridge.com/social-card-11f0eb1f-2897-5bfe-9c67-a51cfdf7c5a5.jpg"/><meta data-react-helmet="true" property="og:title" content="Actix-Web with sessions"/><meta data-react-helmet="true" property="og:description" content="A simple sessions implementation with actix-web"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://danielbetteridge.com/social-card-11f0eb1f-2897-5bfe-9c67-a51cfdf7c5a5.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Betteridge"/><meta data-react-helmet="true" name="twitter:image" content="https://danielbetteridge.com/social-card-11f0eb1f-2897-5bfe-9c67-a51cfdf7c5a5.jpg"/><meta data-react-helmet="true" name="twitter:title" content="Actix-Web with sessions"/><meta data-react-helmet="true" name="twitter:description" content="A simple sessions implementation with actix-web"/><link as="script" rel="preload" href="/webpack-runtime-6b425858c581ab184ae8.js"/><link as="script" rel="preload" href="/framework-8e528b732ab2eaadb7b7.js"/><link as="script" rel="preload" href="/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/app-d7daaed8063e93431db2.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-7c17764a622bd4c2d98c.js"/><link as="script" rel="preload" href="/cd7d5f864fc9e15ed8adef086269b0aeff617554-5c25f2d1e7d76bf8dde7.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-1b09473509c9e397ef19.js"/><link as="fetch" rel="preload" href="/page-data/actix-web-sessions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3537562275.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/426816048.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:49rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Occasional Blog</a></h3></header><main><h1 style="margin-top:1.75rem;margin-bottom:0">Actix-Web with sessions</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">February 17, 2021</p><p>My goal in this post is to show some basic user registration (User actix handlers and calls to postgres) and session management using session tokens and actix_session to store them on the client.</p><hr/><h3>Disclaimer</h3><p>I am learning Rust and do not pretend that this is the best solution or even particularly good Rust code.</p><hr/><h3>Folder structure</h3><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:199px">
      <a class="gatsby-resp-image-link" href="/static/1116da89f07ade14ca6687fee65db647/3d64b/FolderStructure.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:152.02702702702703%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHElEQVRIx51W2ZLaSBDkOxz26GpdratbF0gCgQYGBntsh8cPuxH7sP//FemUsPE4NrwW81AhEJBkVmZXaWFJjch30VQV0lWG7u8twsSHMC24jsOyb6qFlVTTDx3hwfElRJxAuN6ra2FGBWIpUVUrtJWJc2/A8y4fui9KCPeX97+rhRWX8F2XIAGBLZSZTblkbP2sH2BzQBc2JdvGHbqH92h2e3hFCn2/RPmx57VG2hXwAn8+wxFQWCZU3SCvasgiQdLmSNYVqg9rpHx9M6Bjmii7fgIM6wxxlcGPJBxbULJ4jWQDq+GIpt8hOzaon9ZQwxJeSGaOe6Mpo2TbQqxyRElKd2lQGLIC+DKcai7YL6b050/oH07QJzL8sqUpa+gH9vVhCVfMjw5jw2DbNgIZsyRcZnCMyvihFwSTZGHP7yMZ1rDu3mH4+BXD+yeoEwP+dYf684DNv4+o2M/ivEZcppNJsxn6MkIQ0tmAPYtjiCiC4D2PbgeJhOf7twW7P3/G5nDAsHyDT1sDT9s7HNcGVOTAtgk0V/LV5YxhzjIk0kGtBPJUQLN8z4VpjV9mL8V/z/hvc9jcn7Da9AQz0JUOhtbCvjPRljZqzTPtXEBnnhQDRceotC3W5Vs8Uuqpp+SNQVCL9+z5gFZUIvA9xBFjQ0OiWDMuKSOUwTD9Sa5pv5AsZoyvgH3KdYG8rHC/2+J+GNA1qwnEm1i534FmMBwHrGSg40xRFnPGeEzhdl5kTrh/ZHYFvAsUqnaD4fED4pVC89cBinNQOOL1E3taRv7lmI3sxpqO23jshHvb+DKjccowf7pC3Ci0/xywfN6zBg6JHapzx/Vwg+SJobjkLNQJpKbbSYxQxRyy4XVAzGZohBpZpvH8/AxZpSiO7TS2sk0BfVyh5BpIVvo6geblkD3TSsPnEBj3iT40vPIBoFbTTgliOZvlwuCTgyoqLDc7BCpC0mi6TTBuv9H1pC2Qku3PLP5Jssyh8nLaJ5LLqaQJ9ZcB+WEJtV8i5wRX+/qSxVvWqGXZkyznuuTF5WpeSlwD7s4YsGMOPf///30mw2+/H3mIXWanFwAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Basic folder setup" title="Basic folder setup" src="/static/1116da89f07ade14ca6687fee65db647/3d64b/FolderStructure.png" srcSet="/static/1116da89f07ade14ca6687fee65db647/12f09/FolderStructure.png 148w,/static/1116da89f07ade14ca6687fee65db647/3d64b/FolderStructure.png 199w" sizes="(max-width: 199px) 100vw, 199px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><hr/><h3>Database schema</h3><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/sql/schema.sql">SQL Schema</a></p><hr/><h3>Registering a new user</h3><p>First we define a user model and map it to our users table.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token attribute attr-name">#[derive(Deserialize, PostgresMapper, Serialize, Debug)]</span>
  <span class="token attribute attr-name">#[pg_mapper(table = <span class="token string">&quot;users&quot;</span>)]</span> <span class="token comment">// singular &#x27;user&#x27; is a keyword..</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">{</span>
      <span class="token keyword">pub</span> email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      <span class="token keyword">pub</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      <span class="token keyword">pub</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/models.rs#L5">User model</a></p><hr/><p>Next we define a handler which is responsible for taking the HTTP request and returning some kind of response.<br/>
<!-- -->We hash the password provided, writing this back into the User object in place of the plaintext password.<br/>
<!-- -->This user is stored into the database and the result returned as JSON to the API caller.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">add_user</span><span class="token punctuation">(</span>
      user<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">User</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
      db_pool<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">Pool</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token keyword">mut</span> user_info<span class="token punctuation">:</span> <span class="token class-name">User</span> <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> hashed <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user_info<span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token constant">DEFAULT_COST</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      user_info<span class="token punctuation">.</span>password <span class="token operator">=</span> hashed<span class="token punctuation">;</span>
      <span class="token keyword">let</span> client<span class="token punctuation">:</span> <span class="token class-name">Client</span> <span class="token operator">=</span> db_pool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">PoolError</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> new_user <span class="token operator">=</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token function">add_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> user_info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
      <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>new_user<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/handlers.rs#L13">add_user in handlers.rs</a></p><hr/><p>This is the way to link a particular route and HTTP method to a handler function.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token namespace">web<span class="token punctuation">::</span></span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token namespace">web<span class="token punctuation">::</span></span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>add_user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><p>The full code can be found in
<a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/main.rs#L32">main.rs</a></p><hr/><p>The actual code run in <code class="language-text">db::add_user</code> is shown below.<br/>
<!-- -->the <code class="language-text">iter().map().collect().pop()</code> step converts the returned rows from a postgres datastructure to a valid User model row by row
then collect them up into a Rust Vector and return the top result with pop.<br/>
<!-- -->We could alternatively use <code class="language-text">.query_one</code> in place of <code class="language-text">.query</code> and convert that directly to a single User or an error message.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">add_user</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> user_info<span class="token punctuation">:</span> <span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">MyError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _stmt <span class="token operator">=</span> <span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;../sql/add_user.sql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _stmt <span class="token operator">=</span> _stmt<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;$table_fields&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">User</span><span class="token punctuation">::</span><span class="token function">sql_table_fields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> stmt <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_stmt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    client
        <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
            <span class="token operator">&amp;</span>stmt<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                <span class="token operator">&amp;</span>user_info<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>user_info<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>user_info<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>user_info<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
        <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>row<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">User</span><span class="token punctuation">::</span><span class="token function">from_row_ref</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">User</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/db.rs#L15">The full file of database functions</a></p><hr/><h3>Session Handler and database function</h3><p>The core of the session handling can be found in main.rs and handlers.rs login function</p><hr/><p>We use an actix-session to create a cookie, This cookie also allows us to set values much like using localStorage in the browser.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">CookieSession</span><span class="token punctuation">::</span><span class="token function">signed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">secure</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/main.rs#L24">main.rs section on CookieSession</a></p><hr/><p>Here we are taking the session token returned from the database login call and setting it in our session cookie for later use.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token keyword">let</span> db_session <span class="token operator">=</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> user_info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
  session<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;session&quot;</span><span class="token punctuation">,</span> db_session<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/handlers.rs#L30">The full login handler</a></p><hr/><p>We extract the session token from the session cookie and pass it to our database auth function.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token keyword">let</span> session_token <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> session_token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/handlers.rs#L116">The auth handler</a></p><hr/><p>The database call to perform auth essentially checks that the given token exists in the database,
if it does then it checks that less then an hour has passed since it was created.<br/>
<!-- -->If more then an hour has passed or if the session token isn’t in the database we return an AuthError.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token keyword">match</span> client
      <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stmt<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>session_token<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
      <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>row<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
          <span class="token punctuation">(</span>
              <span class="token class-name">User</span><span class="token punctuation">::</span><span class="token function">from_row_ref</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">Session</span><span class="token punctuation">::</span><span class="token function">from_row_ref</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">AuthError</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;No valid session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token class-name">Ok</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> created<span class="token punctuation">:</span> <span class="token class-name">DateTime</span><span class="token operator">&lt;</span><span class="token class-name">Utc</span><span class="token operator">&gt;</span> <span class="token operator">=</span> r<span class="token number">.1</span><span class="token punctuation">.</span>created<span class="token punctuation">;</span>
          <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Utc</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> hour <span class="token operator">=</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> has_not_expired <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>created<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>hour<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> has_not_expired <span class="token punctuation">{</span>
              <span class="token class-name">Ok</span><span class="token punctuation">(</span>r<span class="token number">.0</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">AuthError</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;No valid session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/db.rs#L159">The database function that checks sessions</a></p><hr/><p>We run the auth check and use the returned user object when auth is successful or throw an error if it fails.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">  <span class="token keyword">match</span> <span class="token function">auth</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> db_pool<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
          <span class="token class-name">Ok</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> client<span class="token punctuation">:</span> <span class="token class-name">Client</span> <span class="token operator">=</span> db_pool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">PoolError</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> db_trades <span class="token operator">=</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token function">trades</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>db_trades<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span></code></pre></div><p><a href="https://github.com/dbetteridge/actix-session-example/blob/master/src/handlers.rs#L63">The auth handler in use</a></p><hr/><h3>Summary</h3><p>And thats it, a simple user registration and session auth using actix.<br/>
<!-- -->My next goal is re-write this using the actix actor model, so if that interests you keep an eye out for part 2.</p><hr/><h3>Links</h3><p><a href="https://github.com/dbetteridge/actix-session-example">Full Github Repo</a></p><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMFAQQG/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAGzgnwd2whykpK+Ef/EABoQAAMBAQEBAAAAAAAAAAAAAAECAwAREBP/2gAIAQEAAQUCsxATobWI5Hx2O+jabFp//8QAFREBAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQMBAT8Bg//EABURAQEAAAAAAAAAAAAAAAAAACBB/9oACAECAQE/AaP/xAAeEAACAgICAwAAAAAAAAAAAAABEQACIUEQEjFRcf/aAAgBAQAGPwKq2YOpsj5B4AedT0fvDeZSzypUnc//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMRBB/9oACAEBAAE/ISS+DOzJew0fBQBumIXZ9I15atNdcvyHszs0K5//2gAMAwEAAgADAAAAEJv4v//EABcRAQADAAAAAAAAAAAAAAAAABABEUH/2gAIAQMBAT8Qijh//8QAFxEBAAMAAAAAAAAAAAAAAAAAEAERQf/aAAgBAgEBPxCbGn//xAAcEAACAwEBAQEAAAAAAAAAAAABEQAhMVFhcaH/2gAIAQEAAT8QT0uRYISVw5cMWYJo0W0e1FE3lYdN7wew9fdbDdkeX+xzMwtIVs1mRNlv6hFhqoCDn//Z" alt="Daniel Betteridge" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/d378fa1d5077a9bc5e617b4f3db3515a/99438/profile-pic.jpg 1x,
/static/d378fa1d5077a9bc5e617b4f3db3515a/aba1d/profile-pic.jpg 1.5x,
/static/d378fa1d5077a9bc5e617b4f3db3515a/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/d378fa1d5077a9bc5e617b4f3db3515a/99438/profile-pic.jpg 1x,
/static/d378fa1d5077a9bc5e617b4f3db3515a/aba1d/profile-pic.jpg 1.5x,
/static/d378fa1d5077a9bc5e617b4f3db3515a/b315d/profile-pic.jpg 2x" src="/static/d378fa1d5077a9bc5e617b4f3db3515a/99438/profile-pic.jpg" alt="Daniel Betteridge" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p><strong>Daniel Betteridge</strong> lives and works in London<br/>I work to solve business problems, usually with as little code as possible<br/>Follow me on<!-- --> <a href="https://twitter.com/@danrbetteridge" title="Twitter">Twitter</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/honeymoon/">← <!-- -->Honeymoon Part 1</a></li><li></li></ul></main><footer>© <!-- -->2022</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-141206687-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/actix-web-sessions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0eca59d2ee8c0828e3a6.js"],"app":["/app-d7daaed8063e93431db2.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-e9ce600337cc36e5b518.js"],"component---src-pages-404-js":["/component---src-pages-404-js-443b9414fd7616b09644.js"],"component---src-pages-index-js":["/component---src-pages-index-js-96b5b20e3944a4ec52da.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-1b09473509c9e397ef19.js"]};/*]]>*/</script><script src="/polyfill-0eca59d2ee8c0828e3a6.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-1b09473509c9e397ef19.js" async=""></script><script src="/cd7d5f864fc9e15ed8adef086269b0aeff617554-5c25f2d1e7d76bf8dde7.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-7c17764a622bd4c2d98c.js" async=""></script><script src="/app-d7daaed8063e93431db2.js" async=""></script><script src="/styles-755093da0c07f4b49226.js" async=""></script><script src="/framework-8e528b732ab2eaadb7b7.js" async=""></script><script src="/webpack-runtime-6b425858c581ab184ae8.js" async=""></script></body></html>